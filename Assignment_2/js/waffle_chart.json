{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Fertilizer Consumption vs Agricultural GDP — Indexed Trends (0–1, 2010–2022)",
  "width": 550,
  "height": 420,

  "data": {
    "url": "data/Fertilizer_Consumption.csv",
    "format": {"type": "csv"}
  },

  "params": [
    {
      "name": "CountryPick",
      "value": "Malaysia",
      "bind": {
        "input": "select",
        "name": "Country: ",
        "options": ["Malaysia"]
      }
    }
  ],

  "transform": [
    {"filter": "datum.Country_Name == CountryPick"},
    {"calculate": "toNumber(datum.Year)", "as": "Year_num"},
    {"calculate": "trim(datum.Indicator_Name)", "as": "Indicator"},
    {"calculate": "toNumber(datum.Value)", "as": "Val"},
    {
      "filter": "datum.Indicator == 'Fertilizer_consumption' || datum.Indicator == 'Agriculture_GDP%'"
    },
    {
      "calculate": "datum.Indicator == 'Fertilizer_consumption' ? 'Fertilizer (kg/ha)' : 'Agriculture GDP (%)'",
      "as": "Series"
    },
    {
      "window": [
        {"op": "min", "field": "Val", "as": "vmin"},
        {"op": "max", "field": "Val", "as": "vmax"}
      ],
      "frame": [null, null],
      "groupby": ["Series"]
    },
    {"calculate": "(datum.Val - datum.vmin) / (datum.vmax - datum.vmin)", "as": "Index01"}
  ],

  "layer": [
    {
      "mark": {"type": "line", "point": true},
      "encoding": {
        "x": {
          "field": "Year_num",
          "type": "quantitative",
          "title": "Year",
          "axis": {"tickCount": 7, "format": "d"}
        },
        "y": {
          "field": "Index01",
          "type": "quantitative",
          "title": "Relative Level (0–1, min–max per series)"
        },
        "color": {
          "field": "Series",
          "type": "nominal",
          "title": null,
          "scale": {"scheme": "tableau10"}
        },
        "tooltip": [
          {"field": "Country_Name", "title": "Country"},
          {"field": "Year_num", "title": "Year", "format": "d"},
          {"field": "Series", "title": "Series"},
          {"field": "Val", "title": "Raw Value", "format": ".2f"},
          {"field": "Index01", "title": "Scaled (0–1)", "format": ".2f"}
        ]
      }
    },
    {
      "mark": {"type": "rule", "strokeDash": [4, 4], "opacity": 0.35},
      "encoding": {"y": {"datum": 0.5}}
    }
  ],

  "config": {
    "view": {"stroke": null},
    "axis": {"grid": true},
    "legend": {"orient": "top", "labelFontSize": 12, "titleFontSize": 13}
  }
}
