{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": { "text": "Average Crop Yield Composition by State", "fontSize": 18 },
  "width": 350,
  "height": 480,
  "background": "#ffffff",
  "config": {
    "view": { "stroke": null },
    "axis": { "grid": false, "domain": false, "ticks": false, "labels": false },
    "legend": { "titleFontSize": 12, "labelFontSize": 11 }
  },

  "data": {
    "url": "https://raw.githubusercontent.com/masr0004/FIT-3179/main/Assignment_2/data/state_crop_average_yield.csv"
  },

  "params": [
    {
      "name": "SelectState",
      "value": "Johor",
      "bind": {
        "input": "select",
        "name": "Select State: ",
        "options": [
          "Johor","Kedah","Kelantan","Malacca","Negeri Sembilan",
          "Pahang","Penang","Perak","Perlis","Sabah","Sarawak",
          "Selangor","Terengganu"
        ]
      }
    }
  ],

  "transform": [
    { "filter": "trim(datum.state) == SelectState" },
    { "calculate": "replace(datum.crop_type, '_', ' ')", "as": "crop_clean" },
    { "calculate": "toNumber(datum.avg_yield)", "as": "yield_num" },
    { "filter": "isValid(datum.yield_num) && isFinite(datum.yield_num)" }
  ],

  "layer": [
    {
      "mark": { "type": "arc", "innerRadius": 110, "stroke": "#ffffff", "strokeWidth": 2 },
      "encoding": {
        "theta": {
          "aggregate": "sum",
          "field": "yield_num",
          "type": "quantitative",
          "stack": true
        },
        "order": { "field": "yield_num", "type": "quantitative" },
        "color": {
          "field": "crop_clean",
          "type": "nominal",
          "title": "Crop Type",
          "scale": {
            "domain": [
              "cash crops","coconut","fruits","herbs","industrial crops",
              "paddy","spices","vegetables"
            ],
            "range": [
              "#1f77b4","#ff7f0e","#2ca02c","#d62728",
              "#9467bd","#8c564b","#e377c2","#17becf"
            ]
          }
        },
        "tooltip": [
          { "field": "state", "title": "State" },
          { "field": "crop_clean", "title": "Crop" },
          { "aggregate": "sum", "field": "yield_num", "title": "Average Yield (t/ha)", "format": ".2f" }
        ]
      }
    },
    {
      "mark": {
        "type": "text",
        "radius": 140,
        "radiusOffset": 1,
        "fontSize": 14,
        "fontWeight": "bold",
        "fill": "#111"
      },
      "encoding": {
        "theta": {
          "aggregate": "sum",
          "field": "yield_num",
          "type": "quantitative",
          "stack": true
        },
        "order": { "field": "yield_num", "type": "quantitative" },
        "detail": { "field": "crop_clean" },
        "text": {
          "aggregate": "sum",
          "field": "yield_num",
          "type": "quantitative",
          "format": ".2f"
        },
        "color": { "field": "crop_clean", "type": "nominal" }
      }
    }
  ]
}
